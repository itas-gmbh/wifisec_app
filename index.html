<html>
<head>
<meta http-equiv="Content-Security-Policy" content="default-src *; style-src *  'unsafe-inline'; script-src *  'unsafe-inline'; media-src *">
<title>WifiSec Passwort</title>

<link rel="stylesheet" type="text/css" href="style.css" />
<script src="jquery.min.js"></script>
<script src="jquery.cookie.js"></script>
<script type = "text/javascript">

function check() {

server = document.myform.server.value;
pw = document.myform.pw.value;

link = "http://" + server + "/wifisec/login.php";

	//alert(link);

	$.ajax({
	type: "GET",
	  url: link,
	data: "pw=" + pw + "&server=" + server,  
	success: function(data) {	
    //alert( $.cookie("wifisec") );
    if(data=="false") {alert("falsches PW");}
    if(data=="true") {
    	window.localStorage.setItem("wifisec", server);
    	ChangeToList();}
	},
    error: function(xhr, textStatus, errorThrown) {
    alert("keine Verbindung zum Server");
    }
});
}

function ChangeToList() {
//alert("jumped to function");
var cookie = window.localStorage.getItem("wifisec");
alert(cookie);
if( cookie == null ) {alert("no cookie set yet"); return 0;} else {
//alert($.cookie('wifisec'));
link = "http://" + cookie + "/wifisec/list.php";
//alert(link);
	$.ajax({
	type: "GET",
	  url: link,
	data: "pw=nothing",
	dataType: "html",
	success: function(data) {
	//alert(data);	
    	$('#login').hide();
	$('#logout').show();
	$('#result').show();
	$('#result').html(data);
	
	},
    error: function(xhr, textStatus, errorThrown) {
    alert("keine Verbindung zum Server");
    logout();
    }

	
});
}
}

function logout() {
    //$.removeCookie('wifisec');
    
   // document.cookie = 'wifisec' + '=;expires:Thu, 01 Jan 1970 00:00:01 GMT;';
    //location.reload(true);
    window.localStorage.removeItem("wifisec");
    location.reload(true);
}

</script>

</head>

<body onload="javascript:ChangeToList()">
<div id="login">
Passwort eingeben
 <form name="myform" action="">
         Enter Server: <input type="text" name="server"/><br>
	Enter Password: <input type="text" name="pw"/><br>
         <input type="button" value="Go" onclick="check();"/>
      </form>
</div>
<div id="result"></div>
<div id="logout"><a href="javascript:logout()">logout</a></div>

</body>

</html>
